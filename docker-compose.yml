services:
  api:
    image: quip-api-es:local
    container_name: quip-api-es
    network_mode: host
    env_file: .env
    volumes:
      - ./src/data:/app/src/data
    command: >
      uvicorn quip_api_es.app:app
      --host 127.0.0.1
      --port 8080
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request,sys; urllib.request.urlopen('http://127.0.0.1:8080/health', timeout=2).read(); sys.exit(0)"]
      interval: 1s
      timeout: 2s
      retries: 30
      start_period: 2s
    restart: unless-stopped
